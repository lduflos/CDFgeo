{% extends "conteneur.html" %}

{% block map %}
<script>
	// création de la carte avec l'id 'map'
	var mymap = L.map('mymap').setView([37.45, 14.15], 4);

    // utilisation des tuiles de carte d'OpenStreetMap puis ajout à la carte map
	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap);

    {% for  k, v in lieu.items()  %}
    // on boucle sur 'ville intitulé'
    {% if "ville_intitule" in v %}
    // si c'est une ville : création d'un point de coordonnées géo, ajout à la carte et création d'un pop-up
    var {{v["ville_intitule"][:3]}} = L.marker({{v["latlong"][0]}},{{v["latlong"][1]}}).addTo(mymap);
    {{v["ville_intitule"][:3]}}.bindPopup('<ul>{% for m in v["mission"] %}<li>{{m}}</li>{%endfor%}</ul>').openPopup();
    // sinon, c'est un pays : création d'un point de coordonnées géo, ajout à la carte et création d'un pop-up
    {% else %}
    var {{v["pays_intitule"][:3]}} = L.marker({{v["latlong"][0]}},{{v["latlong"][1]}}).addTo(mymap);
    {{v["pays_intitule"][:3]}}.bindPopup('<ul>{% for m in v["mission"] %}<li>{{m}}</li>{%endfor%}</ul>').openPopup();
    {% endif %}
    {% endfor %}
</script>

{% endblock %}
